!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["orchard-lane-media-player"]=t()}(this,function(){"use strict";function e(e,t){return t={exports:{}},e(t,t.exports),t.exports}function t(){try{var e=N;return N=null,e.apply(this,arguments)}catch(e){return U.e=e,U}}function n(e){return N=e,t}function r(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function i(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return r(e)?new Error(d(e)):e}function s(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function a(e,t,n){if(!D.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function c(e,t,n){if(r(e))return e;var i={value:n,configurable:!0,enumerable:!1,writable:!0};return D.defineProperty(e,t,i),e}function u(e){throw e}function l(e){try{if("function"==typeof e){var t=D.names(e.prototype),n=D.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=G.test(e+"")&&D.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function h(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function f(e){return $.test(e)}function p(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function d(e){try{return e+""}catch(e){return"[no string representation]"}}function _(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function v(e){try{c(e,"isOperational",!0)}catch(e){}}function y(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function g(e){return _(e)&&D.propertyIsWritable(e,"stack")}function m(e){return{}.toString.call(e)}function b(e,t,n){for(var r=D.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{D.defineProperty(t,o,D.getDescriptor(e,o))}catch(e){}}}function E(e){return W?process.env[e]:void 0}function w(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function C(e,t){return e.bind(t)}function S(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function k(e){this._capacity=e,this._length=0,this._front=0}function T(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new se(16),this._normalQueue=new se(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=oe}function R(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function F(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function j(e){this._normalQueue._pushOne(e),this._queueTick()}function O(e,t){function n(r){if(!(this instanceof n))return new n(r);fe(this,"message","string"==typeof r?r:t),fe(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return he(n,Error),n}function A(e){if(!(this instanceof A))return new A(e);fe(this,"name","OperationalError"),fe(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(fe(this,"message",e.message),fe(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}function P(e){return e instanceof Error&&D.getPrototypeOf(e)===Error.prototype}function x(e){var t;if(P(e)){t=new Ae(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=D.keys(e),r=0;r<n.length;++r){var i=n[r];Pe.test(i)||(t[i]=e[i])}return t}return J.markAsOriginatingFromRejection(e),e}function B(e,t){return function(n,r){if(null!==e){if(n){var i=x(Oe(n));e._attachExtraTrace(i),e._reject(i)}else if(t){for(var o=arguments.length,s=new Array(Math.max(o-1,0)),a=1;a<o;++a)s[a-1]=arguments[a];e._fulfill(s)}else e._fulfill(r);e=null}}}function I(){try{Promise===st&&(Promise=ot)}catch(e){}return st}var L="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=e(function(e){var t=function(){return void 0===this}();if(t)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:t,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var n={}.hasOwnProperty,r={}.toString,i={}.constructor.prototype,o=function(e){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t},s=function(e,t){return{value:e[t]}},a=function(e,t,n){return e[t]=n.value,e},c=function(e){return e},u=function(e){try{return Object(e).constructor.prototype}catch(e){return i}},l=function(e){try{return"[object Array]"===r.call(e)}catch(e){return!1}};e.exports={isArray:l,keys:o,names:o,defineProperty:a,getDescriptor:s,freeze:c,getPrototypeOf:u,isES5:t,propertyIsWritable:function(){return!0}}}}),V="undefined"==typeof navigator,U={e:{}},N,M="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==L?L:void 0!==L?L:null,H=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},q=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(D.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var c=Object.getOwnPropertyDescriptor(e,a);null!=c&&null==c.get&&null==c.set&&r.push(a)}}e=D.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<e.length;++s)if(r.call(e[s],o))continue e;i.push(o)}return i}}(),G=/this\s*\.\s*\S+\s*=/,$=/^[a-z$_][a-z$_0-9]*$/i,Q=function(){return"stack"in new Error?function(e){return g(e)?e:new Error(d(e))}:function(e){if(g(e))return e;try{throw new Error(d(e))}catch(e){return e}}}(),z=function(e){return D.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var X="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};z=function(e){return D.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?X(e):null}}var Y="undefined"!=typeof process&&"[object process]"===m(process).toLowerCase(),W="undefined"!=typeof process&&void 0!==process.env,K={isClass:l,isIdentifier:f,inheritedDataKeys:q,getDataPropertyOrDefault:a,thrower:u,isArray:D.isArray,asArray:z,notEnumerableProp:c,isPrimitive:r,isObject:i,isError:_,canEvaluate:V,errorObj:U,tryCatch:n,inherits:H,withAppended:s,maybeWrapAsError:o,toFastProperties:h,filledRange:p,toString:d,canAttachTrace:g,ensureErrorObject:Q,originatesFromRejection:y,markAsOriginatingFromRejection:v,classString:m,copyDescriptors:b,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:Y,hasEnvVariables:W,env:E,global:M,getNativePromise:w,domainBind:C};K.isRecentNode=K.isNode&&function(){var e=process.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),K.isNode&&K.toFastProperties(process);try{throw new Error}catch(e){K.lastLineError=e}var J=K,Z,ee=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},te=J.getNativePromise();if(J.isNode&&"undefined"==typeof MutationObserver){var ne=L.setImmediate,re=process.nextTick;Z=J.isRecentNode?function(e){ne.call(L,e)}:function(e){re.call(process,e)}}else if("function"==typeof te&&"function"==typeof te.resolve){var ie=te.resolve();Z=function(e){ie.then(e)}}else Z="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:ee:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();var oe=Z;k.prototype._willBeOverCapacity=function(e){return this._capacity<e},k.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},k.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},k.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},k.prototype.length=function(){return this._length},k.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},k.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,S(this,0,this,t,this._front+this._length&t-1)};var se=k,ae;try{throw new Error}catch(e){ae=e}T.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},T.prototype.hasCustomScheduler=function(){return this._customScheduler},T.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},T.prototype.disableTrampolineIfNecessary=function(){J.hasDevTools&&(this._trampolineEnabled=!1)},T.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},T.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},T.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},J.hasDevTools?(T.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?R.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},T.prototype.invoke=function(e,t,n){this._trampolineEnabled?F.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},T.prototype.settlePromises=function(e){this._trampolineEnabled?j.call(this,e):this._schedule(function(){e._settlePromises()})}):(T.prototype.invokeLater=R,T.prototype.invoke=F,T.prototype.settlePromises=j),T.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},T.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},T.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},T.prototype._reset=function(){this._isTickUsed=!1};var ce=T,ue=ae;ce.firstLineError=ue;var le=D.freeze,he=J.inherits,fe=J.notEnumerableProp,pe,de,_e=O("Warning","warning"),ve=O("CancellationError","cancellation error"),ye=O("TimeoutError","timeout error"),ge=O("AggregateError","aggregate error");try{pe=TypeError,de=RangeError}catch(e){pe=O("TypeError","type error"),de=O("RangeError","range error")}for(var me="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),be=0;be<me.length;++be)"function"==typeof Array.prototype[me[be]]&&(ge.prototype[me[be]]=Array.prototype[me[be]]);D.defineProperty(ge.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),ge.prototype.isOperational=!0;var Ee=0;ge.prototype.toString=function(){var e=Array(4*Ee+1).join(" "),t="\n"+e+"AggregateError of:\n";Ee++,e=Array(4*Ee+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];r=i.join("\n"),t+=r+"\n"}return Ee--,t},he(A,Error);var we=Error.__BluebirdErrorTypes__;we||(we=le({CancellationError:ve,TimeoutError:ye,OperationalError:A,RejectionError:A,AggregateError:ge}),D.defineProperty(Error,"__BluebirdErrorTypes__",{value:we,writable:!1,enumerable:!1,configurable:!1}));var Ce={Error:Error,TypeError:pe,RangeError:de,CancellationError:we.CancellationError,OperationalError:we.OperationalError,TimeoutError:we.TimeoutError,AggregateError:we.AggregateError,Warning:_e},Se=function(e,t){function n(n,r){if(u(n)){if(n instanceof e)return n;var a=i(n);if(a===c){r&&r._pushContext();var l=e.reject(a.e);return r&&r._popContext(),l}if("function"==typeof a){if(o(n)){var l=new e(t);return n._then(l._fulfill,l._reject,void 0,l,null),l}return s(n,a,r)}}return n}function r(e){return e.then}function i(e){try{return r(e)}catch(e){return c.e=e,c}}function o(e){try{return l.call(e,"_promise0")}catch(e){return!1}}function s(n,r,i){function o(e){u&&(u._resolveCallback(e),u=null)}function s(e){u&&(u._rejectCallback(e,h,!0),u=null)}var u=new e(t),l=u;i&&i._pushContext(),u._captureStackTrace(),i&&i._popContext();var h=!0,f=a.tryCatch(r).call(n,o,s);return h=!1,u&&f===c&&(u._rejectCallback(f.e,!0,!0),u=null),l}var a=J,c=a.errorObj,u=a.isObject,l={}.hasOwnProperty;return n},ke=function(e,t,n,r,i){function o(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function s(n){var r=this._promise=new e(t);n instanceof e&&r._propagateFrom(n,3),r._setOnCancel(this),this._values=n,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var a=J;a.isArray;return a.inherits(s,i),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function t(i,s){var c=n(this._values,this._promise);if(c instanceof e){c=c._target();var u=c._bitField;if(this._values=c,0==(50397184&u))return this._promise._setAsyncGuaranteed(),c._then(t,this._reject,void 0,this,s);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(c._reason()):this._cancel();c=c._value()}if(null===(c=a.asArray(c))){var l=r("expecting an array or an iterable object but got "+a.classString(c)).reason();return void this._promise._rejectCallback(l,!1)}if(0===c.length)return void(-5===s?this._resolveEmptyArray():this._resolve(o(s)));this._iterate(c)},s.prototype._iterate=function(t){var r=this.getActualLength(t.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<r;++a){var c=n(t[a],i);c instanceof e?(c=c._target(),s=c._bitField):s=null,o?null!==s&&c.suppressUnhandledRejections():null!==s?0==(50397184&s)?(c._proxy(this,a),this._values[a]=c):o=0!=(33554432&s)?this._promiseFulfilled(c._value(),a):0!=(16777216&s)?this._promiseRejected(c._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(c,a)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s},Te=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,c=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=c,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t},Re=function(e,t){function n(e,t){return{promise:t}}function r(){return!1}function i(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+D.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function o(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?D.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function s(){return this._onCancelField}function a(e){this._onCancelField=e}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function l(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function f(){this._trace=new O(this._peekContext())}function p(e,t){if(V(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=w(e);D.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),D.notEnumerableProp(e,"__stackCleaned__",!0)}}}function d(e,t,n,r,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),c=b(a),u=c.length-1;u>=0;--u){var l=c[u];if(!N.test(l)){var h=l.match(M);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(c.length>0)for(var f=c[0],u=0;u<a.length;++u)if(a[u]===f){u>0&&(s="\n"+a[u-1]);break}}var p="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(p,!0,t)}}function _(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),v(n)}function v(t,n,r){if(oe.warnings){var i,o=new L(t);if(n)r._attachExtraTrace(o);else if(oe.longStackTraces&&(i=e._peekContext()))i.attachExtraTrace(o);else{var s=w(o);o.stack=s.message+"\n"+s.stack.join("\n")}ee("warning",o)||C(o,"",!0)}}function y(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function g(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function m(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(var a=s;a>=0;--a){var c=r[a];if(t[i]!==c)break;t.pop(),i--}t=r}}function b(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||H.test(r),o=i&&ne(r);i&&!o&&(G&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function E(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||H.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function w(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?E(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:b(t)}}function C(e,t,n){if("undefined"!=typeof console){var r;if(D.isObject(e)){var i=e.stack;r=t+q(i,e)}else r=t+String(e);"function"==typeof x?x(r,n):"function"==typeof console.log||console.log}}function S(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){I.throwLater(e)}"unhandledRejection"===e?ee(e,n,r)||i||C(n,"Unhandled rejection "):ee(e,r)}function k(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():D.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+T(t)+">, no stack trace)"}function T(e){return e.length<41?e:e.substr(0,38)+"..."}function R(){return"function"==typeof ie}function F(e){var t=e.match(re);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function j(e,t){if(R()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,c=0;c<i.length;++c){var u=F(i[c]);if(u){n=u.fileName,s=u.line;break}}for(var c=0;c<o.length;++c){var u=F(o[c]);if(u){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(ne=function(e){if(U.test(e))return!0;var t=F(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}}function O(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ie(this,O),t>32&&this.uncycle()}var A,P,x,B=e._getDomain,I=e._async,L=Ce.Warning,D=J,V=D.canAttachTrace,U=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,N=/\((?:timers\.js):\d+:\d+\)/,M=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,H=null,q=null,G=!1,$=!(0==D.env("BLUEBIRD_DEBUG")||!D.env("BLUEBIRD_DEBUG")&&"development"!==D.env("NODE_ENV")),Q=!(0==D.env("BLUEBIRD_WARNINGS")||!$&&!D.env("BLUEBIRD_WARNINGS")),z=!(0==D.env("BLUEBIRD_LONG_STACK_TRACES")||!$&&!D.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=D.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(Q||!!D.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},e.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},e.prototype._notifyUnhandledRejectionIsHandled=function(){S("rejectionHandled",A,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),S("unhandledRejection",P,e,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(e,t,n){return v(e,t,n||this)},e.onPossiblyUnhandledRejection=function(e){var t=B();P="function"==typeof e?null===t?e:D.domainBind(t,e):void 0},e.onUnhandledRejectionHandled=function(e){var t=B();A="function"==typeof e?null===t?e:D.domainBind(t,e):void 0};var Y=function(){};e.longStackTraces=function(){if(I.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!oe.longStackTraces&&R()){var n=e.prototype._captureStackTrace,r=e.prototype._attachExtraTrace;oe.longStackTraces=!0,Y=function(){if(I.haveItemsQueued()&&!oe.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=n,e.prototype._attachExtraTrace=r,t.deactivateLongStackTraces(),I.enableTrampoline(),oe.longStackTraces=!1},e.prototype._captureStackTrace=f,e.prototype._attachExtraTrace=p,t.activateLongStackTraces(),I.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return oe.longStackTraces&&R()};var W=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!D.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return D.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!D.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),D.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!D.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),K=function(){return D.isNode?function(){return process.emit.apply(process,arguments)}:D.global?function(e){var t="on"+e.toLowerCase(),n=D.global[t];return!!n&&(n.apply(D.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),Z={promiseCreated:n,promiseFulfilled:n,promiseRejected:n,promiseResolved:n,promiseCancelled:n,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:n},ee=function(e){var t=!1;try{t=K.apply(null,arguments)}catch(e){I.throwLater(e),t=!0}var n=!1;try{n=W(e,Z[e].apply(null,arguments))}catch(e){I.throwLater(e),n=!0}return n||t};e.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&Y()),"warnings"in t){var n=t.warnings;oe.warnings=!!n,X=oe.warnings,D.isObject(n)&&"wForgottenReturn"in n&&(X=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!oe.cancellation){if(I.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=c,e.prototype._propagateFrom=u,e.prototype._onCancel=s,e.prototype._setOnCancel=a,e.prototype._attachCancellationCallback=o,e.prototype._execute=i,te=u,oe.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!oe.monitoring?(oe.monitoring=!0,e.prototype._fireEvent=ee):!t.monitoring&&oe.monitoring&&(oe.monitoring=!1,e.prototype._fireEvent=r)),e},e.prototype._fireEvent=r,e.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(e){},e.prototype._attachCancellationCallback=function(e){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(e,t){};var te=l,ne=function(){return!1},re=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;D.inherits(O,Error),t.CapturedTrace=O,O.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<e;++r){var s=t[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var c=r>0?t[r-1]:this;a<e-1?(c._parent=t[a+1],c._parent.uncycle(),c._length=c._parent._length+1):(c._parent=void 0,c._length=1);for(var u=c._length+1,l=r-2;l>=0;--l)t[l]._length=u,u++;return}}}},O.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=w(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(b(i.stack.split("\n"))),i=i._parent;m(r),g(r),D.notEnumerableProp(e,"stack",y(n,r)),D.notEnumerableProp(e,"__stackCleaned__",!0)}};var ie=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():k(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,H=e,q=t;var n=Error.captureStackTrace;return ne=function(e){return U.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return H=/@/,q=t,G=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(q=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?k(t):t.toString()},null):(H=e,q=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(x=function(e){},D.isNode&&process.stderr.isTTY?x=function(e,t){}:D.isNode||"string"!=typeof(new Error).stack||(x=function(e,t){}));var oe={warnings:Q,longStackTraces:!1,cancellation:!1,monitoring:!1};return z&&e.longStackTraces(),{longStackTraces:function(){return oe.longStackTraces},warnings:function(){return oe.warnings},cancellation:function(){return oe.cancellation},monitoring:function(){return oe.monitoring},propagateFromFunction:function(){return te},boundValueFunction:function(){return h},checkForgottenReturns:d,setBounds:j,warn:v,deprecated:_,CapturedTrace:O,fireDomEvent:W,fireGlobalEvent:K}},Fe=function(e){function t(t,s,a){return function(c){var u=a._boundValue();e:for(var l=0;l<t.length;++l){var h=t[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(c instanceof h)return i(s).call(u,c)}else if("function"==typeof h){var f=i(h).call(u,c);if(f===o)return f;if(f)return i(s).call(u,c)}else if(n.isObject(c)){for(var p=r(h),d=0;d<p.length;++d){var _=p[d];if(h[_]!=c[_])continue e}return i(s).call(u,c)}}return e}}var n=J,r=D.keys,i=n.tryCatch,o=n.errorObj;return t},je=function(e,t,n){function r(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function i(e){this.finallyHandler=e}function o(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return c.call(this,this.promise._target()._settledValue())}function a(e){if(!o(this,e))return h.e=e,h}function c(r){var c=this.promise,u=this.handler;if(!this.called){this.called=!0;var f=this.isFinallyHandler()?u.call(c._boundValue()):u.call(c._boundValue(),r);if(f===n)return f;if(void 0!==f){c._setReturnedNonUndefined();var p=t(f,c);if(p instanceof e){if(null!=this.cancelPromise){if(p._isCancelled()){var d=new l("late cancellation observer");return c._attachExtraTrace(d),h.e=d,h}p.isPending()&&p._attachCancellationCallback(new i(this))}return p._then(s,a,void 0,this,void 0)}}}return c.isRejected()?(o(this),h.e=r,h):(o(this),r)}var u=J,l=e.CancellationError,h=u.errorObj,f=Fe(n);return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(e,t,n,i){return"function"!=typeof e?this.then():this._then(n,i,void 0,new r(this,t,e),void 0)},e.prototype.lastly=e.prototype.finally=function(e){return this._passThrough(e,0,c,c)},
e.prototype.tap=function(e){return this._passThrough(e,1,c)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,c);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var s=arguments[r];if(!u.isObject(s))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(s)));i[o++]=s}i.length=o;var a=arguments[r];return this._passThrough(f(i,a,this),1,void 0,c)},r},Oe=J.maybeWrapAsError,Ae=Ce.OperationalError,Pe=/^(?:name|message|stack|cause)$/,xe=B,Be=function(e,t,n,r,i){var o=J,s=o.tryCatch;e.method=function(n){if("function"!=typeof n)throw new e.TypeError("expecting a function but got "+o.classString(n));return function(){var r=new e(t);r._captureStackTrace(),r._pushContext();var o=s(n).apply(this,arguments),a=r._popContext();return i.checkForgottenReturns(o,a,"Promise.method",r),r._resolveFromSyncValue(o),r}},e.attempt=e.try=function(n){if("function"!=typeof n)return r("expecting a function but got "+o.classString(n));var a=new e(t);a._captureStackTrace(),a._pushContext();var c;if(arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];c=o.isArray(u)?s(n).apply(l,u):s(n).call(l,u)}else c=s(n)();var h=a._popContext();return i.checkForgottenReturns(c,h,"Promise.try",a),a._resolveFromSyncValue(c),a},e.prototype._resolveFromSyncValue=function(e){e===o.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}},Ie=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var u=n(o),l=new e(t);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(u),u instanceof e){var f={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:u};h._then(t,s,void 0,l,f),u._then(a,c,void 0,l,f),l._setOnCancel(u)}else l._resolveCallback(h);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}},Le=function(e,t,n,r){var i=J,o=i.tryCatch,s=i.errorObj,a=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=o(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),a.throwLater(r.e))}}else e._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}},De=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}},Ve=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t},Ue=function(e,t,n,r,i,o){var s,a=J,c=a.canEvaluate,u=a.tryCatch,l=a.errorObj;if(c){for(var h=[],f=[],p=[],d=0;d<8;++d)h.push(function(t){for(var n=new Array(t),r=0;r<n.length;++r)n[r]="this.p"+(r+1);var o=n.join(" = ")+" = null;",s="var promise;\n"+n.map(function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),a=n.join(", "),c="Holder$"+t,h="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return h=h.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,t).replace(/\[ThePassedArguments\]/g,a).replace(/\[TheProperties\]/g,o).replace(/\[CancellationCode\]/g,s),new Function("tryCatch","errorObj","Promise","async",h)(u,l,e,i)}(d+1)),f.push(function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))}(d+1)),p.push(function(e){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))}(d+1));s=function(e){this._reject(e)}}e.join=function(){var i,u=arguments.length-1;if(u>0&&"function"==typeof arguments[u]&&(i=arguments[u],u<=8&&c)){var l=new e(r);l._captureStackTrace();for(var d=h[u-1],_=new d(i),v=f,y=0;y<u;++y){var g=n(arguments[y],l);if(g instanceof e){g=g._target();var m=g._bitField;0==(50397184&m)?(g._then(v[y],s,void 0,l,_),p[y](g,_),_.asyncNeeded=!1):0!=(33554432&m)?v[y].call(l,g._value(),_):0!=(16777216&m)?l._reject(g._reason()):l._cancel()}else v[y].call(l,g,_)}if(!l._isFateSealed()){if(_.asyncNeeded){var b=o();null!==b&&(_.fn=a.domainBind(b,_.fn))}l._setAsyncGuaranteed(),l._setOnCancel(_)}return l}for(var E=arguments.length,w=new Array(E),C=0;C<E;++C)w[C]=arguments[C];i&&w.pop();var l=new t(w).promise();return void 0!==i?l.spread(i):l}},Ne=function(e,t,n,r,i,o){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var o=c();this._callback=null===o?t:u.domainBind(o,t),this._preservedValues=r===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}function a(t,r,i,o){if("function"!=typeof r)return n("expecting a function but got "+u.classString(r));var a=0;if(void 0!==i){if("object"!=typeof i||null===i)return e.reject(new TypeError("options argument must be an object but it is "+u.classString(i)));if("number"!=typeof i.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(i.concurrency)));a=i.concurrency}return a="number"==typeof a&&isFinite(a)&&a>=1?a:0,new s(t,r,a,o).promise()}var c=e._getDomain,u=J,l=u.tryCatch,h=u.errorObj,f=e._async;u.inherits(s,t),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,n){var i=this._values,s=this.length(),a=this._preservedValues,c=this._limit;if(n<0){if(n=-1*n-1,i[n]=t,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return i[n]=t,this._queue.push(n),!1;null!==a&&(a[n]=t);var u=this._promise,f=this._callback,p=u._boundValue();u._pushContext();var d=l(f).call(p,t,n,s),_=u._popContext();if(o.checkForgottenReturns(d,_,null!==a?"Promise.filter":"Promise.map",u),d===h)return this._reject(d.e),!0;var v=r(d,this._promise);if(v instanceof e){v=v._target();var y=v._bitField;if(0==(50397184&y))return c>=1&&this._inFlight++,i[n]=v,v._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(v._reason()),!0):(this._cancel(),!0);d=v._value()}i[n]=d}return++this._totalResolved>=s&&(null!==a?this._filter(i,a):this._resolve(i),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(e,t){return a(this,e,t,null)},e.map=function(e,t,n,r){return a(e,t,n,r)}},Me=Object.create;if(Me){var He=Me(null),qe=Me(null);He[" size"]=qe[" size"]=0}var Ge=function(e){function t(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+a.classString(t)+" has no method '"+a.toString(n)+"'";throw new e.TypeError(i)}return r}function n(e){return t(e,this.pop()).apply(e,this)}function r(e){return e[this]}function i(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var o,s,a=J,c=a.canEvaluate,u=a.isIdentifier,l=function(e){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,e))(t)},h=function(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))},f=function(e,t,n){var r=n[e];if("function"!=typeof r){if(!u(e))return null;if(r=t(e),n[e]=r,++n[" size"]>512){for(var i=Object.keys(n),o=0;o<256;++o)delete n[i[o]];n[" size"]=i.length-256}}return r};o=function(e){return f(e,l,He)},s=function(e){return f(e,h,qe)},e.prototype.call=function(e){for(var t=arguments.length,r=new Array(Math.max(t-1,0)),i=1;i<t;++i)r[i-1]=arguments[i];if(c){var s=o(e);if(null!==s)return this._then(s,void 0,void 0,r,void 0)}return r.push(e),this._then(n,void 0,void 0,r,void 0)},e.prototype.get=function(e){var t,n="number"==typeof e;if(n)t=i;else if(c){var o=s(e);t=null!==o?o:r}else t=r;return this._then(t,void 0,void 0,e,void 0)}},$e=function(e,t,n,r,i,o){function s(e){setTimeout(function(){throw e},0)}function a(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(t,r){function o(){if(c>=u)return l._fulfill();var i=a(t[c++]);if(i instanceof e&&i._isDisposable()){try{i=n(i._getDisposer().tryDispose(r),t.promise)}catch(e){return s(e)}if(i instanceof e)return i._then(o,s,null,null,null)}o()}var c=0,u=t.length,l=new e(i);return o(),l}function u(e,t,n){this._data=e,this._promise=t,this._context=n}function l(e,t,n){this.constructor$(e,t,n)}function h(e){return u.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function f(e){this.length=e,this.promise=null,this[e-1]=null}var p=J,d=Ce.TypeError,_=J.inherits,v=p.errorObj,y=p.tryCatch,g={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():g},u.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==g?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},u.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},_(l,u),l.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},f.prototype._resultCancelled=function(){for(var t=this.length,n=0;n<t;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var r=arguments.length;if(r<2)return t("you must pass at least 2 arguments to Promise.using");var i=arguments[r-1];if("function"!=typeof i)return t("expecting a function but got "+p.classString(i));var s,a=!0;2===r&&Array.isArray(arguments[0])?(s=arguments[0],r=s.length,a=!1):(s=arguments,r--);for(var l=new f(r),d=0;d<r;++d){var _=s[d];if(u.isDisposer(_)){var g=_;_=_.promise(),_._setDisposable(g)}else{var m=n(_);m instanceof e&&(_=m._then(h,null,null,{resources:l,index:d},void 0))}l[d]=_}for(var b=new Array(l.length),d=0;d<b.length;++d)b[d]=e.resolve(l[d]).reflect();var E=e.all(b).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return v.e=n.error(),v;if(!n.isFulfilled())return void E.cancel();e[t]=n.value()}w._pushContext(),i=y(i);var r=a?i.apply(void 0,e):i(e),s=w._popContext();return o.checkForgottenReturns(r,s,"Promise.using",w),r}),w=E.lastly(function(){var t=new e.PromiseInspection(E);return c(l,t)});return l.promise=w,w._setOnCancel(l),w},e.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(e){if("function"==typeof e)return new l(e,this,r());throw new d}},Qe=function(e,t,n){function r(e){this.handle=e}function i(e){return clearTimeout(this.handle),e}function o(e){throw clearTimeout(this.handle),e}var s=J,a=e.TimeoutError;r.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return u(+this).thenReturn(e)},u=e.delay=function(i,o){var s,a;return void 0!==o?(s=e.resolve(o)._then(c,null,null,i,void 0),n.cancellation()&&o instanceof e&&s._setOnCancel(o)):(s=new e(t),a=setTimeout(function(){s._fulfill()},+i),n.cancellation()&&s._setOnCancel(new r(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};e.prototype.delay=function(e){return u(e,this)};var l=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new a("operation timed out"):new a(t),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};e.prototype.timeout=function(e,t){e=+e;var s,a,c=new r(setTimeout(function(){s.isPending()&&l(s,t,a)},e));return n.cancellation()?(a=this.then(),s=a._then(i,o,void 0,c,void 0),s._setOnCancel(c)):s=this._then(i,o,void 0,c,void 0),s}},ze=function(e,t,n,r,i,o){function s(t,n,i){for(var o=0;o<n.length;++o){i._pushContext();var s=f(n[o])(t);if(i._popContext(),s===h){i._pushContext();var a=e.reject(h.e);return i._popContext(),a}var c=r(s,i);if(c instanceof e)return c}return null}function a(t,r,i,s){if(o.cancellation()){var a=new e(n),c=this._finallyPromise=new e(n);this._promise=a.lastly(function(){return c}),a._captureStackTrace(),a._setOnCancel(this)}else{(this._promise=new e(n))._captureStackTrace()}this._stack=s,this._generatorFunction=t,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}var c=Ce,u=c.TypeError,l=J,h=l.errorObj,f=l.tryCatch,p=[];l.inherits(a,i),a.prototype._isResolved=function(){return null===this._promise},a.prototype._cleanup=function(){this._promise=this._generator=null,o.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},a.prototype._promiseCancelled=function(){if(!this._isResolved()){var t,n=void 0!==this._generator.return;if(n)this._promise._pushContext(),t=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),t=f(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},a.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=f(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},a.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=f(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},a.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},a.prototype.promise=function(){return this._promise},a.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},a.prototype._continue=function(t){var n=this._promise;if(t===h)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var i=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(i);var o=r(i,this._promise);if(!(o instanceof e)&&null===(o=s(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(i))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var a=o._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?e._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?e._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},e.coroutine=function(e,t){if("function"!=typeof e)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=a,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("expecting a function but got "+l.classString(e));p.push(e)},e.spawn=function(n){if(o.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return t("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new a(n,this),i=r.promise();return r._run(e.spawn),i}},Xe=function(e){function t(e,t){var r=this;if(!i.isArray(e))return n.call(r,e,t);var c=s(t).apply(r._boundValue(),[null].concat(e));c===a&&o.throwLater(c.e)}function n(e,t){var n=this,r=n._boundValue(),i=void 0===e?s(t).call(r,null):s(t).call(r,null,e);i===a&&o.throwLater(i.e)}function r(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=s(t).call(n._boundValue(),e);i===a&&o.throwLater(i.e)}var i=J,o=e._async,s=i.tryCatch,a=i.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(e,i){if("function"==typeof e){var o=n;void 0!==i&&Object(i).spread&&(o=t),this._then(o,r,void 0,this,e)}return this}},Ye=function(e,t){function n(e){return!b.test(e)}function r(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function i(e,t,n){var i=f.getDataPropertyOrDefault(e,t+n,g);return!!i&&r(i)}function o(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function s(e,t,n,s){for(var a=f.inheritedDataKeys(e),c=[],u=0;u<a.length;++u){var l=a[u],h=e[l],p=s===E||E(l,h,e);"function"!=typeof h||r(h)||i(e,l,t)||!s(l,h,e,p)||c.push(l,h)}return o(c,t,n),c}function a(n,r,i,o,s,a){function c(){var i=r;r===h&&(i=this);var o=new e(t);o._captureStackTrace();var s="string"==typeof l&&this!==u?this[l]:n,c=p(o,a);try{s.apply(i,d(arguments,c))}catch(e){o._rejectCallback(_(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var u=function(){return this}(),l=n;return"string"==typeof l&&(n=o),f.notEnumerableProp(c,"__isPromisified__",!0),c}function c(e,t,n,r,i){for(var o=new RegExp(w(t)+"$"),a=s(e,t,o,n),c=0,u=a.length;c<u;c+=2){var l=a[c],p=a[c+1],d=l+t;if(r===R)e[d]=R(l,h,l,p,t,i);else{var _=r(p,function(){return R(l,h,l,p,t,i)});f.notEnumerableProp(_,"__isPromisified__",!0),e[d]=_}}return f.toFastProperties(e),e}function u(e,t,n){return R(e,t,void 0,e,null,n)}var l,h={},f=J,p=xe,d=f.withAppended,_=f.maybeWrapAsError,v=f.canEvaluate,y=Ce.TypeError,g={__isPromisified__:!0},m=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],b=new RegExp("^(?:"+m.join("|")+")$"),E=function(e){return f.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},w=function(e){return e.replace(/([$])/,"\\$")},C=function(e){for(var t=[e],n=Math.max(0,e-1-3),r=e-1;r>=n;--r)t.push(r);for(var r=e+1;r<=3;++r)t.push(r);return t},S=function(e){return f.filledRange(e,"_arg","")},k=function(e){return f.filledRange(Math.max(e,3),"_arg","")},T=function(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0};l=function(n,r,i,o,s,a){function c(e){var t,n=S(e).join(", "),i=e>0?", ":"";return t=v?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===r?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n",t.replace("{{args}}",n).replace(", ",i)}var u=Math.max(0,T(o)-1),l=C(u),v="string"==typeof n||r===h,y="string"==typeof n?"this != null ? this['"+n+"'] : fn":"fn",g="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+a+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var e="",t=0;t<l.length;++t)e+="case "+l[t]+":"+c(l[t]);return e+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",v?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",y);return g=g.replace("Parameters",k(u)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",g)(e,o,r,d,_,p,f.tryCatch,f.errorObj,f.notEnumerableProp,t)};var R=v?l:a;e.promisify=function(e,t){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));if(r(e))return e;t=Object(t);var i=void 0===t.context?h:t.context,o=!!t.multiArgs,s=u(e,i,o);return f.copyDescriptors(e,s,n),s},e.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=E);var o=t.promisifier;if("function"!=typeof o&&(o=R),
!f.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=f.inheritedDataKeys(e),a=0;a<s.length;++a){var u=e[s[a]];"constructor"!==s[a]&&f.isClass(u)&&(c(u.prototype,r,i,o,n),c(u,r,i,o,n))}return c(e,r,i,o,n)}},We=function(e,t,n,r){function i(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=l(e),n=!0;else{var r=u.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function o(t){var o,s=n(t);return c(s)?(o=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new i(s).promise(),s instanceof e&&o._propagateFrom(s,2),o):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,a=J,c=a.isObject,u=D;"function"==typeof Map&&(s=Map);var l=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),h=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};a.inherits(i,t),i.prototype._init=function(){},i.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=h(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},i.prototype.shouldCopyValues=function(){return!1},i.prototype.getActualLength=function(e){return e>>1},e.prototype.props=function(){return o(this)},e.props=function(e){return o(e)}},Ke=function(e,t,n,r){function i(i,a){var c=n(i);if(c instanceof e)return s(c);if(null===(i=o.asArray(i)))return r("expecting an array or an iterable object but got "+o.classString(i));var u=new e(t);void 0!==a&&u._propagateFrom(a,3);for(var l=u._fulfill,h=u._reject,f=0,p=i.length;f<p;++f){var d=i[f];(void 0!==d||f in i)&&e.cast(d)._then(l,h,void 0,u,null)}return u}var o=J,s=function(e){return e.then(function(t){return i(t,e)})};e.race=function(e){return i(e,void 0)},e.prototype.race=function(){return i(this,void 0)}},Je=function(e,t,n,r,i,o){function s(t,n,r,o){this.constructor$(t);var s=h();this._fn=null===s?n:f.domainBind(s,n),void 0!==r&&(r=e.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===i?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function a(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,r,i){return"function"!=typeof t?n("expecting a function but got "+f.classString(t)):new s(e,t,r,i).promise()}function u(t){this.accum=t,this.array._gotAccum(t);var n=r(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(l,void 0,void 0,this,void 0)):l.call(this,n)}function l(t){var n=this.array,r=n._promise,i=p(n._fn);r._pushContext();var s;(s=void 0!==n._eachValues?i.call(r._boundValue(),t,this.index,this.length):i.call(r._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=s);var a=r._popContext();return o.checkForgottenReturns(s,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),s}var h=e._getDomain,f=J,p=f.tryCatch;f.inherits(s,t),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==i&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},s.prototype._iterate=function(t){this._values=t;var n,r,i=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(u,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(a,a,void 0,n,this)},e.prototype.reduce=function(e,t){return c(this,e,t,null)},e.reduce=function(e,t,n,r){return c(e,t,n,r)}},Ze=function(e,t,n){function r(e){this.constructor$(e)}var i=e.PromiseInspection;J.inherits(r,t),r.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(e,t){var n=new i;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},r.prototype._promiseRejected=function(e,t){var n=new i;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return n.deprecated(".settle()",".reflect()"),new r(e).promise()},e.prototype.settle=function(){return e.settle(this)}},et=function(e,t,n){function r(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new r(e),o=i.promise();return i.setHowMany(t),i.init(),o}var o=J,s=Ce.RangeError,a=Ce.AggregateError,c=o.isArray,u={};o.inherits(r,t),r.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(e){this._howMany=e},r.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new a,t=this.length();t<this._values.length;++t)this._values[t]!==u&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(e){this._values.push(e)},r.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return i(e,t)},e.prototype.some=function(e){return i(this,e)},e._SomePromiseArray=r},tt=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}},nt=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r},rt=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}},it=e(function(e){e.exports=function(){function t(){}function n(e,t){if(null==e||e.constructor!==r)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new y("expecting a function but got "+f.classString(t))}function r(e){e!==m&&n(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function i(e){this.promise._resolveCallback(e)}function o(e){this.promise._rejectCallback(e,!1)}function s(e){var t=new r(m);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var a,c=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},u=function(){return new r.PromiseInspection(this._target())},l=function(e){return r.reject(new y(e))},h={},f=J;a=f.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},f.notEnumerableProp(r,"_getDomain",a);var p=D,d=ce,_=new d;p.defineProperty(r,"_async",{value:_});var v=Ce,y=r.TypeError=v.TypeError;r.RangeError=v.RangeError;var g=r.CancellationError=v.CancellationError;r.TimeoutError=v.TimeoutError,r.OperationalError=v.OperationalError,r.RejectionError=v.OperationalError,r.AggregateError=v.AggregateError;var m=function(){},b={},E={},w=Se(r,m),C=ke(r,m,w,l,t),S=Te(r),k=S.create,T=Re(r,S),R=(T.CapturedTrace,je(r,w,E)),F=Fe(E),j=xe,O=f.errorObj,A=f.tryCatch;return r.prototype.toString=function(){return"[object Promise]"},r.prototype.caught=r.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!f.isObject(o))return l("Catch statement predicate: expecting an object but got "+f.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,F(r,e,this))}return this.then(void 0,e)},r.prototype.reflect=function(){return this._then(u,u,void 0,this,void 0)},r.prototype.then=function(e,t){if(T.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+f.classString(e);arguments.length>1&&(n+=", "+f.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},r.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},r.prototype.spread=function(e){return"function"!=typeof e?l("expecting a function but got "+f.classString(e)):this.all()._then(e,void 0,void 0,b,void 0)},r.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},r.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},r.prototype.error=function(e){return this.caught(f.originatesFromRejection,e)},r.getNewLibraryCopy=e.exports,r.is=function(e){return e instanceof r},r.fromNode=r.fromCallback=function(e){var t=new r(m);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,i=A(e)(j(t,n));return i===O&&t._rejectCallback(i.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},r.all=function(e){return new C(e).promise()},r.cast=function(e){var t=w(e);return t instanceof r||(t=new r(m),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},r.resolve=r.fulfilled=r.cast,r.reject=r.rejected=function(e){var t=new r(m);return t._captureStackTrace(),t._rejectCallback(e,!0),t},r.setScheduler=function(e){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));return _.setScheduler(e)},r.prototype._then=function(e,t,n,i,o){var s=void 0!==o,c=s?o:new r(m),u=this._target(),l=u._bitField;s||(c._propagateFrom(this,3),c._captureStackTrace(),void 0===i&&0!=(2097152&this._bitField)&&(i=0!=(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,c));var h=a();if(0!=(50397184&l)){var p,d,v=u._settlePromiseCtx;0!=(33554432&l)?(d=u._rejectionHandler0,p=e):0!=(16777216&l)?(d=u._fulfillmentHandler0,p=t,u._unsetRejectionIsUnhandled()):(v=u._settlePromiseLateCancellationObserver,d=new g("late cancellation observer"),u._attachExtraTrace(d),p=t),_.invoke(v,u,{handler:null===h?p:"function"==typeof p&&f.domainBind(h,p),promise:c,receiver:i,value:d})}else u._addCallbacks(e,t,c,i,h);return c},r.prototype._length=function(){return 65535&this._bitField},r.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},r.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},r.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},r.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},r.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},r.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},r.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},r.prototype._isFinal=function(){return(4194304&this._bitField)>0},r.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},r.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},r.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},r.prototype._setAsyncGuaranteed=function(){_.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},r.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==h)return void 0===t&&this._isBound()?this._boundValue():t},r.prototype._promiseAt=function(e){return this[4*e-4+2]},r.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},r.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},r.prototype._boundValue=function(){},r.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(t,n,r,i,null)},r.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=h),this._addCallbacks(n,r,i,o,null)},r.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:f.domainBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:f.domainBind(i,t))}return this._setLength(o+1),o},r.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},r.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(c(),!1);var n=w(e,this);if(!(n instanceof r))return this._fulfill(e);t&&this._propagateFrom(n,2);var i=n._target();if(i===this)return void this._reject(c());var o=i._bitField;if(0==(50397184&o)){var s=this._length();s>0&&i._migrateCallback0(this);for(var a=1;a<s;++a)i._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var u=new g("late cancellation observer");i._attachExtraTrace(u),this._reject(u)}}},r.prototype._rejectCallback=function(e,t,n){var r=f.ensureErrorObject(e),i=r===e;if(!i&&!n&&T.warnings()){var o="a promise was rejected with a non-error: "+f.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},r.prototype._resolveFromExecutor=function(e){if(e!==m){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},r.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===b?n&&"number"==typeof n.length?o=A(e).apply(this._boundValue(),n):(o=O,o.e=new y("cannot .spread() a non-array: "+f.classString(n))):o=A(e).call(t,n);var s=r._popContext();i=r._bitField,0==(65536&i)&&(o===E?r._reject(n):o===O?r._rejectCallback(o.e,!1):(T.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},r.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},r.prototype._followee=function(){return this._rejectionHandler0},r.prototype._setFollowee=function(e){this._rejectionHandler0=e},r.prototype._settlePromise=function(e,n,i,o){var s=e instanceof r,a=this._bitField,c=0!=(134217728&a);0!=(65536&a)?(s&&e._invokeInternalOnCancel(),i instanceof R&&i.isFinallyHandler()?(i.cancelPromise=e,A(n).call(i,o)===O&&e._reject(O.e)):n===u?e._fulfill(u.call(i)):i instanceof t?i._promiseCancelled(e):s||e instanceof C?e._cancel():i.cancel()):"function"==typeof n?s?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(n,i,o,e)):n.call(i,o,e):i instanceof t?i._isResolved()||(0!=(33554432&a)?i._promiseFulfilled(o,e):i._promiseRejected(o,e)):s&&(c&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(o):e._reject(o))},r.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,i=e.receiver,o=e.value;"function"==typeof t?n instanceof r?this._settlePromiseFromHandler(t,i,o,n):t.call(i,o,n):n instanceof r&&n._reject(o)},r.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},r.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},r.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},r.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=c();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():_.settlePromises(this))}},r.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return _.fatalError(e,f.isNode);(65535&t)>0?_.settlePromises(this):this._ensurePossibleRejectionHandled()}},r.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},r.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},r.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},r.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},r.defer=r.pending=function(){return T.deprecated("Promise.defer","new Promise"),{promise:new r(m),resolve:i,reject:o}},f.notEnumerableProp(r,"_makeSelfResolutionError",c),Be(r,m,w,l,T),Ie(r,m,w,T),Le(r,C,l,T),De(r),Ve(r),Ue(r,C,w,m,_,a),r.Promise=r,r.version="3.5.1",Ne(r,C,l,w,m,T),Ge(r),$e(r,l,w,k,m,T),Qe(r,m,T),ze(r,l,m,w,t,T),Xe(r),Ye(r,m),We(r,C,w,l),Ke(r,m,w,l),Je(r,C,l,w,m,T),Ze(r,C,T),et(r,C,l),tt(r,m),nt(r,m),rt(r),f.toFastProperties(r),f.toFastProperties(r.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new r(m)),T.setBounds(d.firstLineError,f.lastLineError),r}}),ot;"undefined"!=typeof Promise&&(ot=Promise);var st=it();st.noConflict=I;var at=st,ct=e(function(e){!function(t){function n(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function r(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,i){var o,s=this._indexOfListener(e,r);if(-1!==s){if(o=this._bindings[s],o.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new n(this,e,t,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,r=this._bindings.length;r--;)if(n=this._bindings[r],n._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return r(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return r(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){r(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=i;o.Signal=i,e.exports?e.exports=o:t.signals=o}(L)}),ut=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ht=function(e){return"function"==typeof e||!1},ft=function(){function e(){ut(this,e),this.listeners=new Map}return e.prototype.on=function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)},e.prototype.off=function(e,t){var n=this.listeners.get(e),r=void 0;return!!(n&&n.length&&(r=n.reduce(function(e,n,r){return ht(n)&&n===t?e=r:e},-1))>-1)&&(n.splice(r,1),this.listeners.set(e,n),!0)},e.prototype.emit=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this.listeners.get(e);return!(!i||!i.length)&&(i.forEach(function(e){e.apply(void 0,n)}),!0)},e}(),pt=new ft,dt={VO_ADDED:"VO_ADDED",VIDEO_FINISHED:"VIDEO_FINISHED",VO_PLAYBACK_PROGRESS:"VO_PLAYBACK_PROGRESS",MEDIASOURCE_STATE:"MEDIASOURCE_STATE",PLAYLIST:"PLAYLIST"},_t={FATAL:"FATAL",RECOVER:"RECOVER",APPEND_FAILED:"APPEND_FAILED",MEDIASOURCE:"MEDIASOURCE",VIDEO_ID:"VIDEO_ID",SIDX:"SIDX",VIDEO_VO:"VIDEO_VO",NO_PLAYLISTS:"NO_PLAYLISTS",EXHAUSED_VIDEO_REFERENCES:"EXHAUSED_VIDEO_REFERENCES"},vt={VIDEO:"video",AUDIO:"audio"},yt={IDLE:"IDLE",BUSY:"BUSY"},gt={IDLE:"IDLE",BUSY:"BUSY"},mt={VIDEO_PASSED_DURATION:"VIDEO_PASSED_DURATION"},bt={USER_EVENTS:dt,ERROR_TYPES:_t,MEDIASOURCE_TYPES:vt,CONTROLLER_STATE:yt,MEDIASOURCE_STATE:gt,BEHAVIORS:mt},Et=!0,wt=!1,Ct=20,St={READY_STATE_CHANGE:"readystatechange",LOAD_START:"loadstart",PROGRESS:"progress",ABORT:"abort",ERROR:"error",LOAD:"load",TIMEOUT:"timeout",LOAD_END:"loadend"},kt=function(){function e(e){var t="";return e.responseText&&(t=this.opts.json?JSON.parse(e.responseText):e.responseText),t}function t(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new at(function(t,o){function s(){c.removeEventListener(St.ABORT,s),c.removeEventListener(St.ERROR,s),c.removeEventListener(St.TIMEOUT,s),e(c)}function a(){if(c.readyState==c.DONE){c.removeEventListener(St.ABORT,s),c.removeEventListener(St.ERROR,s),c.removeEventListener(St.TIMEOUT,s),c.removeEventListener(St.READY_STATE_CHANGE,a);var e=new Uint8Array(c.response);c=null,r=null,t(e)}}var c=new XMLHttpRequest;c.open("GET",n,!0),c.responseType="arraybuffer",Object.keys(i).forEach(function(e){c.setRequestHeader(e,i[e])}),c.addEventListener(St.ABORT,s),c.addEventListener(St.ERROR,s),c.addEventListener(St.TIMEOUT,s),c.addEventListener(St.READY_STATE_CHANGE,a),c.send(r)})}function n(e,n){n=n||e.indexUrl;var r=Object.keys(i);r.length>Ct&&(delete i[r[0]],i.shift());var o=i[e.id];if(o)return at.resolve(o);var s={Range:"bytes="+e.indexRange,"X-Accel-Buffering":"no","Accept-Ranges":"bytes","Content-Type":"multipart/form-data","Access-Control-Allow-Origin":"*"};return t(e,n,null,s).then(function(t){return wt&&(i[e.id]=t),t})}function r(e,n){return n=n||e.rangeUrl,t(e,n,null,{Range:"bytes="+e.byteRange,"X-Accel-Buffering":"no","Accept-Ranges":"bytes","Content-Type":"multipart/form-data","Access-Control-Allow-Origin":"*"})}var i={};return{indexRange:n,range:r}}(),Tt=bt.ERROR_TYPES,Rt=!0,Ft=4,jt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ut(this,e);var r=document.createElement("video");if(r.setAttribute("crossOrigin","anonymous"),r.setAttribute("crossorigin","anonymous"),r.setAttribute("controls","true"),n.paused||r.setAttribute("autoplay","true"),this.options=n,this.el=r,!MediaSource)throw new Error("NO MEDIASOURCE!");this.updatedStarted,this.locked,this.starting=!0,this.segDuration=0,this.totalDuration=0,this.newVoStarted=!1,this.requestingNewVo=!1,this.playOffset=0,this.segmentIndex=0,this.totalSegments=0,this.paused=!1,this.ended=!1,this.currentCodec="",this.skipCount=0,this._currentVo,this.mediaSource,this.sourceBuffer,this._effects,this.currentVideoId,this.readySignal=this.options.readySignal,this.videoPlayingSignal=this.options.videoPlayingSignal,this.videoStartedSignal=this.options.videoStartedSignal,this.videoUpdateStartedSignal=this.options.videoUpdatedStartedSignal,this.videoUpdateEndedSignal=this.options.videoUpdateEndedSignal,this.segmentAddedSignal=this.options.segmentAddedSignal,this.timeUpdateSignal=this.options.timeUpdateSignal,this.endingSignal=this.options.endingSignal,this.endedSignal=this.options.endedSignal,this.videoElement=r,this.onBufferUpdateStartBound=this.onBufferUpdateStart.bind(this),this.onBufferUpdateEndBound=this.onBufferUpdateEnd.bind(this),this.onTimeUpdateBound=this._onTimeUpdate.bind(this),this.onBufferSourceRemovedBound=this._onBufferSourceRemoved.bind(this),this.onSourceOpenBound=this._onSourceOpen.bind(this),this.onSourceErrorBound=this._onSourceError.bind(this),this.videoElement.addEventListener("timeupdate",this.onTimeUpdateBound,!1),this.videoElement.addEventListener("ended",this._onVideoEnded,!1),this.videoElement.addEventListener("loadeddata",function(){}),this.videoElement.addEventListener("playing",function(){t._waiting=!1,t.videoPlayingSignal.dispatch()}),this.videoElement.addEventListener("waiting",function(){t._waiting=!0}),this.videoElement.addEventListener("pause",function(){t._waiting=!0}),this.videoElement.addEventListener("loadstart",function(){t._waiting=!1}),this._newMediaSource(),this.waitingLine=[]}return e.prototype._newMediaSource=function(){this.starting=!0,this.mediaSource=new MediaSource;var e=URL.createObjectURL(this.mediaSource);this.videoElement.src=e,this.mediaSource.addEventListener("error",this.onSourceErrorBound,!1),this.mediaSource.addEventListener("sourceopen",this.onSourceOpenBound,!1)},e.prototype._onSourceError=function(e){},e.prototype._onSourceOpen=function(e){this.starting=!1,this.readySignal.dispatch(this),pt.emit("mediasource:ready",this),this.waitingLine.length},e.prototype.newBufferSouce=function(e){var t=this;return new at(function(n,r){t._removeSourceBuffer().then(function(){setTimeout(function(){t.mediaSource.removeEventListener("sourceopen",t.onSourceOpenBound),t.currentCodec=e||t.currentCodec,t.mediaSource.addEventListener("addsourcebuffer",function(){}),t.sourceBuffer=t.mediaSource.addSourceBuffer('video/mp4; codecs="'+e+'"'),t.sourceBuffer.addEventListener("updatestart",t.onBufferUpdateStartBound),t.sourceBuffer.addEventListener("updateend",t.onBufferUpdateEndBound),n()},2e3)})})},e.prototype.pause=function(){this.videoElement.pause()},e.prototype.play=function(){this.videoElement.play()},e.prototype._onVideoEnded=function(e){},e.prototype._onTimeUpdate=function(){var e=this.videoElement.currentTime;e>this.currentVo.startTime&&!this.newVoStarted&&(this.newVoStarted=!0,this.videoStartedSignal.dispatch(this.currentVo),pt.emit("mediasource:videostarting",this)),e>=this.totalDuration-Ft&&(this.requestingNewVo||(this.requestingNewVo=!0,this.endingSignal.dispatch(this),pt.emit("mediasource:ending",this))),e>=this.totalDuration-.1&&(this.ended||(this.ended=!0,this.endedSignal.dispatch(this),pt.emit("mediasource:ended",this))),this.timeUpdateSignal.dispatch(e)},e.prototype.stepBack=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.videoElement.currentTime-e;this.videoElement.currentTime=t},e.prototype.stepForward=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.videoElement.currentTime+e;t>this.totalDuration&&(t=this.totalDuration-Ft),this.videoElement.currentTime=t},e.prototype.setPlaybackRate=function(e){this.videoElement.playbackRate=e},e.prototype.getReadyState=function(){return this.mediaSource.readyState},e.prototype.setCurrentVideoId=function(e){this.currentVideoId=e},e.prototype.getCurrentVideoId=function(e){return this.currentVideoId},e.prototype.addVo=function(e){var t=this;return new at(function(n,r){if(t._addingSegment)return r(new Error("Vo being added"));t._addingSegment=!0,t._currentVo=e,t.currentCodec?t.sourceBuffer?(Rt&&(pt.emit("audio:log","Sourcebuffer updating: "+t.sourceBuffer.updating),pt.emit("audio:log","Sourcebuffer mode: "+t.sourceBuffer.mode)),n(t._readyToAdd(e))):pt.emit("audio:warn","The codecs arnt equal"):(pt.emit("audio:warn","The codecs arnt equal"),t.newBufferSouce(e.codecs).then(function(){n(t._readyToAdd(e))}))})},e.prototype._readyToAdd=function(e){return this.setCurrentVideoId(e.id),this.mediaSource.duration=this.totalDuration,this._addSegment(e)},e.prototype._onBufferSourceRemoved=function(){},e.prototype.onBufferUpdateStart=function(){
this.updatedStarted=!0,this.requestingNewVo=!1,this.ended=!1,pt.emit("mediasource:updatestart",this)},e.prototype.onBufferUpdateEnd=function(){this.updatedStarted=!1,pt.emit("mediasource:updateend",this),Rt&&pt.emit("audio:log","Sourcebuffer updated. Is updating: "+this.sourceBuffer.updating)},e.prototype._addSegment=function(e){var t=this;this.newVoStarted=!1,this.currentVo=e,this.currentVo.startTime=this.totalDuration,this.totalDuration+=this.currentVo.duration;var n=0;this.currentVo.videoId;return this.sourceBuffer.buffered.length>0&&(n=this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)),this._trySettingOffset(this.currentVo,n).then(function(){return kt.indexRange(t.currentVo).then(function(e){return t._addInitReponse(t.currentVo,e).then(function(){return n=t.sourceBuffer.timestampOffset-t.currentVo.timestampOffset,t._trySettingOffset(t.currentVo,n).then(function(){return kt.range(t.currentVo).then(function(e){return t._addResponse(t.currentVo,e).then(function(){return t._addingSegment=!1,{totalDuration:t.totalDuration,duration:t.currentVo.duration}})})})})})})},e.prototype._trySettingOffset=function(e,t){var n=this;return new at(function(e,r){function i(){if(!s.sourceBuffer.updating){clearInterval(o),pt.emit("audio:log","Sourcebuffer mode: "+s.sourceBuffer.mode);try{s.sourceBuffer.timestampOffset=t||0,e()}catch(t){e()}}}var o=void 0,s=n;o=n._getInterval(i)})},e.prototype._addInitReponse=function(e,t){var n=this;return new at(function(r,i){function o(){s.sourceBuffer.removeEventListener("updateend",o),r()}var s=n;n._canUpdate()&&n.sourceBuffer&&(n.sourceBuffer.removeEventListener("updatestart",n.onBufferUpdateStartBound),n.sourceBuffer.removeEventListener("updateend",n.onBufferUpdateEndBound),n.sourceBuffer.addEventListener("updateend",o),function(){try{s.sourceBuffer.appendBuffer(t)}catch(t){i(new Error(Tt.RECOVER+":"+(e.videoId||e.id)))}}())})},e.prototype._addResponse=function(e,t){var n=this;return new at(function(r,i){function o(){s.sourceBuffer.removeEventListener("updateend",o),s.onBufferUpdateEndBound(),r()}var s=n;if(n._canUpdate()&&n.sourceBuffer){n.sourceBuffer.addEventListener("updateend",o),n.sourceBuffer.addEventListener("updatestart",n.onBufferUpdateStartBound);try{if(n.sourceBuffer.appendBuffer(t),e.seekValue){n.videoElement.currentTime,e.seekValue}n.segmentAddedSignal.dispatch()}catch(e){}}})},e.prototype._getInterval=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return setInterval(e,100)},e.prototype._canUpdate=function(){return"open"===this.mediaSource.readyState&&!this.sourceBuffer.updating},e.prototype._removeSourceBuffer=function(){var e=this;return new at(function(t,n){if(e.sourceBuffer){e.sourceBuffer.removeEventListener("updateend",e.onBufferUpdateEndBound),e.sourceBuffer.removeEventListener("updatestart",e.onBufferUpdateStartBound);try{e.sourceBuffer.remove(0,e.mediaSource.duration)}catch(e){}e.mediaSource.removeSourceBuffer(e.mediaSource.sourceBuffers[0]),e.sourceBuffer=null,t()}else t()})},e.prototype.resetMediasource=function(){var e=this;if(!this.starting&&this.mediaSource)return this._removeSourceBuffer().then(function(){return e.mediaSource.removeEventListener("error",e.onSourceErrorBound),e.mediaSource.removeEventListener("sourceopen",e.onSourceOpenBound),e.mediaSource=null,e.sourceBuffer=null,e.requestingNewVo=!1,e.enterFrameCounter=0,e.videoElement.currentTime=0,e.totalDuration=e.segDuration=e.playOffset=0,e._newMediaSource()})},lt(e,[{key:"el",get:function(){return this.videoElement},set:function(e){this.videoElement=e}},{key:"isPaused",get:function(){return!this.videoElement.playing}},{key:"currentTime",set:function(e){this.videoElement.currentTime=e}},{key:"waiting",get:function(){return this._waiting}}]),e}(),Ot={};Ot.vo={url:void 0,byteRange:void 0,byteRangeMax:void 0,codecs:void 0,firstOffset:void 0,indexRange:void 0,indexRangeMax:void 0,timestampOffset:void 0,durationSec:void 0,videoId:void 0};var At={duration:5};Ot.createVo=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,r=Math.floor(3*Math.random())+1,i=Math.floor(3*Math.random())+1,o=0;if(e.sidx){var s=e.sidx.references;n=Math.floor(s.length/2)-Math.ceil(r/2),n=Math.max(n,0),i=n+Math.max(Math.floor(r/2),1),t.all&&(n=0,i=s.length-1);for(var a=s[n],c=s[i],u=0,l=n;l<i;l++)o+=s[l].durationSec,u+=s[l].size;var h=parseInt(c.mediaRange.split("-")[0],10)-1,f={};return f.url=e.url||e.baseUrl,f.byteRange=a.mediaRange.split("-")[0]+"-"+h,f.byteLength=u,f.codecs=e.codecs,f.firstOffset=e.sidx.firstOffset,f.indexRange=e.indexRange,f.indexLength=Number(f.indexRange.split("-")[1])+1,f.timestampOffset=a.startTimeSec,f.duration=o,f.id=t.videoId,f}},Ot.combineRefsIndexs=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],e.sidx),r=n.references,i=void 0,o=void 0;i=o=t.refIndex,Array.isArray(t.refIndex)&&(i=o=t.refIndex[0],t.refIndex.length>1&&(i=t.refIndex[0],o=t.refIndex[1]));for(var s=r[i],a=r[o],c=0,u=0,l=i;l<=o;l++)u+=r[l].durationSec,c+=r[l].size;var h=parseInt(a.mediaRange.split("-")[1],10),f={};return f.url=e.url||e.baseUrl,f.byteRange=s.mediaRange.split("-")[0]+"-"+h,f.byteLength=c,f.codecs=e.codecs,f.firstOffset=e.sidx.firstOffset,f.indexRange=e.indexRange,f.indexLength=n.firstOffset,f.timestampOffset=s.startTimeSec,f.duration=u,f.videoId=e.videoId,f.id=e.id||f.videoId,f.indexUrl=f.url+"?range="+f.indexRange,f.rangeUrl=f.url+"?range="+f.byteRange,f},Ot.voFromRef=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],e.sidx),r=n.references,i=[],o=i[0]||t[0]||0,s=i[i.length-1]||t[1]||t[0]+1||0,a=r[o],c=r[s],u=0,l=0,h=o;h<=s;h++)l+=r[h].durationSec,u+=r[h].size;var f=parseInt(c.mediaRange.split("-")[1],10),p={};return p.url=e.url||e.baseUrl,p.byteRange=a.mediaRange.split("-")[0]+"-"+f,p.byteLength=u,p.codecs=e.codecs,p.firstOffset=n.firstOffset,p.indexRange="0-"+(n.firstOffset-1),p.indexLength=n.firstOffset,p.timestampOffset=a.startTimeSec,p.duration=l,p.videoId=e.videoId,p.id=e.id||p.videoId,p.indexUrl=p.url,p.rangeUrl=p.url,p},Ot.getReferenceVo=function(e,t){var n=e.sidx,r=n.references[t];return Ot.voFromRef(n,r)},Ot.getReferenceVoFromIndex=function(e,t){var n=e.sidx,r=n.references[t];return Ot.voFromRef(n,r)};var Pt=function(e){var t=new jt({readySignal:new ct,videoStartedSignal:new ct,videoUpdateStartedSignal:new ct,videoUpdateEndedSignal:new ct,videoPlayingSignal:new ct,videoPausedSignal:new ct,videoWaitingSignal:new ct,segmentAddedSignal:new ct,timeUpdateSignal:new ct,endingSignal:new ct,endedSignal:new ct}),n=e.assetUrl||"";return{VOUtils:Ot,mediaSource:t,addFromReference:function(e,r){var i=Ot.voFromRef(Object.assign({},e,{url:""+n+e.videoId+"_"+e.itag}),r);return t.addVo(i),i}}};return window.OrchardLaneMediaPlayer=Pt,Pt});
